<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="description" content="SIMACT home page">
<meta name="keywords" content="TODO">
<meta name="author" content="Markus Lamprecht">
<meta http-equiv="X-UA-Compatible" content="chrome=1">

<title>engine</title>

<!-- base href="http://algebrite.org/" -->

<link rel="stylesheet" href="simact.css">
<meta name="viewport" content="width=device-width">
<!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<!-- KATEX-Latex fast rendering: and information sites:     -->
<link rel="stylesheet" type="text/css" href="libs/katex/katex.min.css" />
<script type="text/javascript" src="libs/katex/katex.min.js"></script>

<!-- Load Numeric.js for eigenvalues!: -->
<script type="text/javascript" src="libs/numeric.js"></script>
<!-- script for Matrices etc. Damit kann man math.im und math.re(...) nutzen geht das mit der standart Math. Bibliothek nicht? TODO-->
<script type="text/javascript" src="libs/math2.js"></script>
<!-- Load Algebrite: -->
<script type="text/javascript" src="libs/Algebrite.js"></script>


<script type="text/javascript" src="libs/jquery-3.2.1.min.js"></script>



<!-- logic for this website -->
<script type="text/javascript" src="simact.js"></script>

</head>
<body>
	<div class="heading">
		<h1>Math Engine</h1>
	</div>
	<div class="wrapper">
		<header>
			<!-- the right part -->
			<a href="http://simact.org/index.html"><img
				src="img/simactlogo.png" alt="simact logo" width="60%">
				<h1>SIMACT</h1></a>
			<p>
				Simulative Adaptive Control Theory.<br> <small><a
					href="https://github.com/davidedc/Algebrite">View on GitHub</a> <br>
					<a href="http://simact.org/index_de.html"><img src="img/de.png"
						alt="de logo" width="10%"></a> <a
					href="http://simact.org/index.html"><img src="img/en.png"
						alt="de logo" width="10%"></a> <a
					href="http://simact.org/index_sp.html"><img src="img/sp.png"
						alt="de logo" width="10%"></a> <a
					href="http://simact.org/index_ch.html"><img src="img/ch.png"
						alt="de logo" width="10%"></a> </small>
			</p>

			<p class="view">
				<strong>Sites</strong> <br> <small><a
					href="SIMACT.html">ZRD</a> <a href="ZRD_ex.html"> ex</a> <br>
					<a href="engine.html">engine</a> </small>
			</p>

			<strong>
				<p class="view">
					<a href="http://algebrite.org/docs/latest-stable/index.html">ZRD
						Theory</a>
				</p>
				<p class="view">
					<a href="http://algebrite.org/sandboxes/latest-stable/sandbox.html">Contact</a>
				</p>
				<p class="view">
					<a href="http://algebrite.org/docs/index.html">Credits/links</a>
				</p>
			</strong>
		</header>

		<section>
			<h2>Input:</h2>
			<textarea rows="10" cols="60" type="text" id="engine_area"
				class="textareaengine">10!
x+x
A=[[8,1],[2,7]] #just defines (assignes) A
B=[[1,2],[2,3]] 
C=[[1,1],[1,1]]
AA=[1,1]
AA
A
B
C
A+B
dot(A,B) #this is actually A*B
dot(A,B,C)
det(A)
inv(A)
denominator(1/(x-1)/(x-2))
simplify(cos(x)^2 + sin(x)^2)
simplify(a*b+a*c)
simplify(n!/(n+1)!)
</textarea>

<textarea readonly rows="10" cols="30" type="text" id="variables_area"
				class="textareaengine">Assigned Variables: 
</textarea>
	<button class="button" id="button_Gleichung" onclick="calculate()">RUN</button>

			<h2>Output:</h2>
<div id="output"></div>


<p><strong>TODO:</strong>
 <br> Matrices no additional line <br> 
 symbolinfo gescheit machen <br>funktionen au√üerhalb von algebrite?
  <br>matrix produkt <br>
  ignore all after # commenting style. </p>
		</section>

<script type="text/javascript" language="javascript">

var resArr;

function calculate(){
	deleteoldDivs();
	execute();
    //console.log(resArr);
	output(resArr);
	myRenderer();
	document.getElementById('variables_area').value = Algebrite.symbolsinfo().toString();
	console.log(Algebrite.symbolsinfo().toString());
}

function execute () {
   // var sandbox = $('sandbox');
    //var jsResult = $('jsResult');
    try {
      var textToBeExecuted = $('#engine_area').val();
    //  console.log("Input:    "+textToBeExecuted);
      var result;
      if (/Algebrite\.[a-z]/.test(textToBeExecuted) || /;[ \t]*$/.test(textToBeExecuted)) {
    	  result = eval(textToBeExecuted);
      }
      else {
        result = Algebrite.run(textToBeExecuted);
      }
      //alert(result);
      //console.log("Result:  "+result);
    resArr = result.split("\n");
      // $('#output' + whichTerminal).val(result) -> store outut in here!
    }
    catch (err) {
    //	console.log(err);
    /*   var errDesc = err;
      errorBox.update('<h4>Error!<\/h4><code>' + errDesc + '<\/code>' );
      errorBox.show(); */ 
    }
}

//resArr: Array [ "120", "720" ]
function output(resArr){
	var textArea = document.getElementById("engine_area");
	//delete assigments with = in input area!
	// delete also empty lines!
	textArea= textArea.value.replace(/^.*=.*$/mg, "");
	textArea = textArea.replace(/(^[ \t]*\n)/gm, "");
	//console.log(textArea);
	inpArr=textArea.split("\n");
	
	for(var p = 0;p<resArr.length;p++){
		var div = document.createElement("div");
		//div.innerHTML = "Hello";
		div.setAttribute('class', 'equation_small'); 
		div.setAttribute('id', p); 
		//console.log(inpArr[p]+"="+resArr[p]);
		var parsedoutput = math.parse(resArr[p]).toTex();
		if(parsedoutput.includes("\\\\end{bmatrix}")){
			parsedoutput=parsedoutput.replace("\\\\end{bmatrix}","\end{bmatrix}");
		}
		div.setAttribute('data-expr', inpArr[p]+"="+parsedoutput); 
		//console.log(div);
		document.getElementById("output").appendChild(div);
	}
}

function deleteoldDivs(){
	var element = document.getElementById("output");
	element.innerHTML = "";
	delete element;
}
    
  </script>
<script type="text/javascript"> myRenderer()</script>

</body>
</html>
